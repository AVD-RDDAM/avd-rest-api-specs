import "@azure-tools/cadl-azure-core";
import "@cadl-lang/rest";
import "./models.cadl";

using Cadl.Rest;
using Cadl.Http;
using Azure.Core;

namespace Azure.OpenAI;

interface Deployments {
  @summary("Gets the list of deployments owned by the Azure OpenAI resource.")
  @doc("Gets the list of deployments owned by the Azure OpenAI resource.")
  List is ResourceList<Deployment>;

  @summary("""
Creates a new deployment for the Azure OpenAI resource according to the given
specification.
""")
  @doc("""
Creates a new deployment for the Azure OpenAI resource according to the given
specification.
""")
  Create is ResourceCreateWithServiceProvidedName<
    Deployment,
    {
      response: Deployment
    }
  >;

  @summary("Gets details for a single deployment specified by the given deployment_id.")
  @doc("Gets details for a single deployment specified by the given deployment_id.")
  Get is ResourceRead<Deployment>;

  @summary("Updates the mutable details of the deployment with the given deployment_id.")
  @doc("Updates the mutable details of the deployment with the given deployment_id.")
  Update is ResourceCreateOrUpdate<Deployment>;

  @summary("Deletes the deployment specified by the given deployment_id.")
  @doc("Deletes the deployment specified by the given deployment_id.")
  Delete is ResourceDelete<Deployment>;
}

interface FilesOperations 
{
  @summary("""
Gets a list of all files owned by the Azure OpenAI resource.
These include user uploaded content like files with purpose "fine-tune" for training or
validation of fine-tunes models as well as files that are generated by the
service such as "fine-tune-results" which contains various metrics for the
corresponding fine-tune job.
""")
  @doc("""
Gets a list of all files owned by the Azure OpenAI resource.
These include user uploaded content like files with purpose \"fine-tune\" for training or
validation of fine-tunes models
as well as files that are generated by the
service such as \"fine-tune-results\" which contains various metrics for the
corresponding fine-tune job.
""")
  List is ResourceList<File>;

  @summary("""
Creates a new file entity by uploading data from a local machine. Uploaded
files can, for example, be used for training or evaluating fine-tuned models.
""")
  @doc("""
Creates a new file entity by uploading data from a local machine. Uploaded
files can, for example, be used for training or evaluating fine-tuned models.
""")
  Upload is ResourceCreateWithServiceProvidedName<File>;

  @summary("""
Gets details for a single file specified by the given file_id including status,
size, purpose, etc.
""")
  @doc("""
Gets details for a single file specified by the given file_id including status,
size, purpose, etc.
""")
  Get is ResourceRead<File>;

  @summary("""
Deletes the file with the given file_id.
Deletion is also allowed if a file
was used, e.g., as training file in a fine-tune job.
""")
  @doc("""
Deletes the file with the given file_id.
Deletion is also allowed if a file
was used, e.g., as training file in a fine-tune job.
""")
  Delete is ResourceDelete<File>;

  @summary("""
Gets the content of the file specified by the given file_id.
Files can be user
uploaded content or generated by the service like result metrics of a fine-tune
job.
""")
  @doc("""
Gets the content of the file specified by the given file_id.
Files can be user
uploaded content or generated by the service like result metrics of a fine-tune
job.
""")
  @route("/files/{fileId}/content")
  @get
  GetFileContent is ResourceAction<File, {}, FileContent>;

  #suppress "@azure-tools/cadl-azure-core/use-standard-operations" "This is an existing service, we have a non-conforming operation."
  @summary("""
Creates a new file entity by importing data from a provided url. Uploaded files
can, for example, be used for training or evaluating fine-tuned models.
""")
  @doc("""
Creates a new file entity by importing data from a provided url. Uploaded files
can, for example, be used for training or evaluating fine-tuned models.
""")
  @route("/files/import")
  @post
  Import is Foundations.Operation<
    {
      @doc("expected schema for the body of the completion post request")
      @body
      body: FileImport;
    },
    File
  >;
}

interface FineTunesOperations {
  @summary("""
Gets a list of all fine-tune jobs owned by the Azure OpenAI resource.
The details that are returned for each fine-tune job contain besides its
identifier the base model, training and validation files, hyper parameters,
time stamps, status and events.  Events are created when the job status
changes, e.g. running or complete, and when results are uploaded.
""")
  @doc("""
Gets a list of all fine-tune jobs owned by the Azure OpenAI resource.
The details that are returned for each fine-tune job contain besides its
identifier the base model, training and validation files, hyper parameters,
time stamps, status and events. Events are created when the job status
changes, e.g. running or complete, and when results are uploaded.
""")
  List is ResourceList<FineTune>;

  @summary("""
Creates a job that fine-tunes a specified model from a given training
file.
Response includes details of the enqueued job including job status and
hyper parameters.
The name of the fine-tuned model is added to the response
once complete.
""")
  @doc("""
Creates a job that fine-tunes a specified model from a given training
file.
Response includes details of the enqueued job including job status and
hyper parameters.
The name of the fine-tuned model is added to the response
once complete.
""")
  @route("/fine-tunes")
  Create is ResourceCreateWithServiceProvidedName<FineTune>;

  @summary("""
Gets details for a single fine-tune job specified by the given
fineTuneId.
The details contain the base model, training and validation
files, hyper parameters, time stamps, status and events.
Events are created
when the job status changes, e.g. running or complete, and when results are
uploaded.
""")
  @doc("""
Gets details for a single fine-tune job specified by the given
fineTuneId.
The details contain the base model, training and validation
files, hyper parameters, time stamps, status and events.
Events are created
when the job status changes, e.g. running or complete, and when results are
uploaded.
""")
  Get is ResourceRead<FineTune>;

  @summary("Deletes the fine-tune job specified by the given fineTuneId.")
  @doc("Deletes the fine-tune job specified by the given fineTuneId.")
  Delete is ResourceDelete<FineTune>;

  @summary("""
Gets the events for the fine-tune job specified by the given fineTuneId.
Events are created when the job status changes, e.g. running or
complete, and when results are uploaded.
""")
  @doc("""
Gets the events for the fine-tune job specified by the given fineTuneId.
Events are created when the job status changes, e.g. running or
complete, and when results are uploaded.
""")
  @route("/fine-tunes/{fineTuneId}/events")
  @get
  GetEvents is ResourceAction<FineTune, {}, EventList>;

  @summary("Cancels the processing of the fine-tune job specified by the given fineTuneId.")
  @doc("Cancels the processing of the fine-tune job specified by the given fineTuneId.")
  @route("/fine-tunes/{fineTuneId}/cancel")
  @post
  Cancel is ResourceAction<FineTune, {}, FineTune>;
}

interface ModelsOperations {
  @summary("""
Gets a list of all models that are accessible by the Azure OpenAI
resource.
These include base models as well as all successfully completed
fine-tuned models owned by the Azure OpenAI resource.
""")
  @doc("""
Gets a list of all models that are accessible by the Azure OpenAI
resource.
These include base models as well as all successfully completed
fine-tuned models owned by the Azure OpenAI resource.
""")
  List is ResourceList<Model>;

  @summary("Gets details for the model specified by the given modelId.")
  @doc("Gets details for the model specified by the given modelId.")
  Get is ResourceRead<Model>;
}
